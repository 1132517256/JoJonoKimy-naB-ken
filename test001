-- AUTOPICKUP CON FILTRO DE ITEMS + MISC + ESP + ESP DIOSES + ESP ITEMS IMPORTANTES + ESP METEOR CORE + CAMERA NOCLIP

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
    Name = "Autopickup Aspiradora",
    LoadingTitle = "Cargando...",
    LoadingSubtitle = "by Tu Script",
    ShowText = "v1.0",
    Theme = "Default"
})

local AutopickupTab = Window:CreateTab("Autopickup", 0)
local MiscTab = Window:CreateTab("Misc", 0)

-- Variables del script
local rs = game:GetService("ReplicatedStorage")
local Modules = rs:WaitForChild("Modules")
local Packets = require(Modules:WaitForChild("Packets"))
local Players = game:GetService("Players")
local player = Players.LocalPlayer

local ITEMS_FOLDER = workspace:WaitForChild("Items")
local PICKUP_DISTANCE = 25

local pickupActive = false
local pickupLoop = nil

local deleteItemsActive = false
local deleteItemsLoop = nil

local espActive = false
local espLoop = nil

local godEspActive = false
local godEspLoop = nil

local itemsEspActive = false
local itemsEspLoop = nil

local meteorEspActive = false
local meteorEspLoop = nil

local cameraNoclipActive = false

local playersWithESP = {}
local playersWithGodESP = {}

-- LISTA DE ITEMS CON FILTRO AUTOPICKUP
local itemFilters = {
    ["Emerald"] = true,
    ["Coal"] = true,
    ["Crystal Chunk"] = true,
    ["Pink Diamond"] = true,
    ["Raw Gold"] = true,
    ["Adurite"] = true,
    ["Gold"] = true,
    ["Iron"] = true,
    ["Spirit Key"] = true,
    ["Steel"] = true,
    ["Magnetite"] = true,
    ["Essence"] = true,
    ["Bloodfruit"] = true,
    ["Coin2"] = true,
}

-- ITEMS IMPORTANTES PARA ESP
local importantItemNames = {
    ["Gold"] = true,
    ["Crystal Chunk"] = true,
}

local function getDistance(a, b)
    return (a.Position - b.Position).Magnitude
end

local function getTeamColor(otherPlayer)
    if otherPlayer.Team then
        return otherPlayer.Team.TeamColor.Color
    end
    return Color3.fromRGB(255, 255, 255)
end

-- ================= AUTOPICKUP =================

local function startPickupLoop()
    if pickupLoop then task.cancel(pickupLoop) end
    
    pickupLoop = task.spawn(function()
        while pickupActive do
            task.wait(0.1)

            local char = player.Character
            if not char then continue end

            local hrp = char:FindFirstChild("HumanoidRootPart")
            if not hrp then continue end

            for _, item in ipairs(ITEMS_FOLDER:GetChildren()) do
                if not itemFilters[item.Name] then continue end
                
                local part = item:IsA("BasePart") and item or item:FindFirstChildWhichIsA("BasePart", true)
                if not part then continue end

                if getDistance(hrp, part) <= PICKUP_DISTANCE then
                    local entityId = item:SetAttribute("EntityID") and item:GetAttribute("EntityID")
                    if entityId then
                        pcall(function()
                            Packets.Pickup.send(entityId)
                        end)
                    end
                end
            end
        end
    end)
end

-- ================= DELETE ITEMS =================

local function startDeleteItemsLoop()
    if deleteItemsLoop then task.cancel(deleteItemsLoop) end
    
    deleteItemsLoop = task.spawn(function()
        while deleteItemsActive do
            task.wait(0.2)
            
            for _, item in ipairs(ITEMS_FOLDER:GetChildren()) do
                pcall(function()
                    item:Destroy()
                end)
            end
        end
    end)
end

-- ================= ESP NORMAL JUGADORES =================

local function startESP()
    if espLoop then task.cancel(espLoop) end
    playersWithESP = {}
    
    espLoop = task.spawn(function()
        while espActive do
            task.wait(0.1)
            
            for _, otherPlayer in ipairs(Players:GetPlayers()) do
                if otherPlayer ~= player then
                    local character = otherPlayer.Character
                    if character then
                        local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
                        local humanoid = character:FindFirstChild("Humanoid")
                        
                        if humanoidRootPart and humanoid then
                            local teamColor = getTeamColor(otherPlayer)
                            
                            local highlight = character:FindFirstChild("ESP_Highlight")
                            
                            if not highlight then
                                highlight = Instance.new("Highlight")
                                highlight.Name = "ESP_Highlight"
                                highlight.Adornee = character
                                highlight.FillColor = teamColor
                                highlight.OutlineColor = teamColor
                                highlight.FillTransparency = 0.7
                                highlight.OutlineTransparency = 0.3
                                highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
                                highlight.Parent = character
                            else
                                highlight.FillColor = teamColor
                                highlight.OutlineColor = teamColor
                            end
                            
                            local billboardGui = character:FindFirstChild("ESP_Label")
                            
                            if not billboardGui then
                                billboardGui = Instance.new("BillboardGui")
                                billboardGui.Name = "ESP_Label"
                                billboardGui.Adornee = humanoidRootPart
                                billboardGui.Size = UDim2.new(0, 120, 0, 40)
                                billboardGui.StudsOffset = Vector3.new(0, 3, 0)
                                billboardGui.MaxDistance = math.huge
                                billboardGui.AlwaysOnTop = true
                                
                                local textLabel = Instance.new("TextLabel")
                                textLabel.Name = "PlayerInfo"
                                textLabel.Size = UDim2.new(1, 0, 1, 0)
                                textLabel.BackgroundTransparency = 1
                                textLabel.TextColor3 = teamColor
                                textLabel.TextSize = 12
                                textLabel.Font = Enum.Font.GothamBold
                                textLabel.TextStrokeTransparency = 0.3
                                textLabel.TextScaled = false
                                textLabel.Parent = billboardGui
                                
                                billboardGui.Parent = character
                            end
                            
                            local label = billboardGui:FindFirstChild("PlayerInfo")
                            if label then
                                label.Text = otherPlayer.Name .. " - " .. math.floor(humanoid.Health) .. "HP"
                                label.TextColor3 = teamColor
                            end
                            
                            playersWithESP[otherPlayer.UserId] = true
                        end
                    end
                end
            end
        end
    end)
end

local function stopESP()
    if espLoop then task.cancel(espLoop) end
    
    task.wait(0.1)
    
    for _, obj in ipairs(workspace:GetDescendants()) do
        if (obj.Name == "ESP_Highlight" or obj.Name == "ESP_Label") then
            pcall(function() obj:Destroy() end)
        end
    end
    
    playersWithESP = {}
    print("✅ ESP eliminado completamente")
end

-- ================= ESP DIOSES =================

local function playerHasGodGear(plr)
    local wsPlayers = workspace:FindFirstChild("Players")
    if not wsPlayers then return false end
    
    local charFolder = wsPlayers:FindFirstChild(plr.Name)
    if not charFolder then return false end
    
    local hasLegs = charFolder:FindFirstChild("God Legs")
    local hasChest = charFolder:FindFirstChild("God Chestplate")
    local hasHalo = charFolder:FindFirstChild("God Halo")
    
    if hasLegs or hasChest or hasHalo then
        return true
    end
    
    return false
end

local function startGodESP()
    if godEspLoop then task.cancel(godEspLoop) end
    playersWithGodESP = {}
    
    godEspLoop = task.spawn(function()
        while godEspActive do
            task.wait(0.15)
            
            for _, otherPlayer in ipairs(Players:GetPlayers()) do
                if otherPlayer ~= player then
                    local character = otherPlayer.Character
                    if character and playerHasGodGear(otherPlayer) then
                        local humanoidRootPart = character:FindFirstChild("HumanoidRootPart")
                        local humanoid = character:FindFirstChild("Humanoid")
                        
                        if humanoidRootPart and humanoid then
                            local teamColor = Color3.fromRGB(255, 215, 0)
                            
                            local highlight = character:FindFirstChild("GOD_ESP_Highlight")
                            
                            if not highlight then
                                highlight = Instance.new("Highlight")
                                highlight.Name = "GOD_ESP_Highlight"
                                highlight.Adornee = character
                                highlight.FillColor = teamColor
                                highlight.OutlineColor = teamColor
                                highlight.FillTransparency = 0.5
                                highlight.OutlineTransparency = 0.1
                                highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
                                highlight.Parent = character
                            else
                                highlight.FillColor = teamColor
                                highlight.OutlineColor = teamColor
                            end
                            
                            local billboardGui = character:FindFirstChild("GOD_ESP_Label")
                            
                            if not billboardGui then
                                billboardGui = Instance.new("BillboardGui")
                                billboardGui.Name = "GOD_ESP_Label"
                                billboardGui.Adornee = humanoidRootPart
                                billboardGui.Size = UDim2.new(0, 150, 0, 45)
                                billboardGui.StudsOffset = Vector3.new(0, 4, 0)
                                billboardGui.MaxDistance = math.huge
                                billboardGui.AlwaysOnTop = true
                                
                                local textLabel = Instance.new("TextLabel")
                                textLabel.Name = "GodPlayerInfo"
                                textLabel.Size = UDim2.new(1, 0, 1, 0)
                                textLabel.BackgroundTransparency = 1
                                textLabel.TextColor3 = teamColor
                                textLabel.TextSize = 13
                                textLabel.Font = Enum.Font.GothamBold
                                textLabel.TextStrokeTransparency = 0.2
                                textLabel.TextScaled = false
                                textLabel.Parent = billboardGui
                                
                                billboardGui.Parent = character
                            end
                            
                            local label = billboardGui:FindFirstChild("GodPlayerInfo")
                            if label then
                                label.Text = "[DIOS] " .. otherPlayer.Name .. " - " .. math.floor(humanoid.Health) .. "HP"
                                label.TextColor3 = teamColor
                            end
                            
                            playersWithGodESP[otherPlayer.UserId] = true
                        end
                    end
                end
            end
        end
    end)
end

local function stopGodESP()
    if godEspLoop then task.cancel(godEspLoop) end
    
    task.wait(0.1)
    
    for _, obj in ipairs(workspace:GetDescendants()) do
        if (obj.Name == "GOD_ESP_Highlight" or obj.Name == "GOD_ESP_Label") then
            pcall(function() obj:Destroy() end)
        end
    end
    
    playersWithGodESP = {}
    print("✅ ESP DIOSES eliminado completamente")
end

-- ================= ESP ITEMS IMPORTANTES =================

local function getItemHighlightColor(name)
    if name == "Gold" then
        return Color3.fromRGB(255, 215, 0)
    elseif name == "Crystal Chunk" then
        return Color3.fromRGB(0, 255, 255)
    else
        return Color3.fromRGB(255, 255, 255)
    end
end

local function startItemsESP()
    if itemsEspLoop then task.cancel(itemsEspLoop) end
    
    itemsEspLoop = task.spawn(function()
        while itemsEspActive do
            task.wait(0.15)
            
            for _, item in ipairs(ITEMS_FOLDER:GetChildren()) do
                if importantItemNames[item.Name] then
                    local part = item:IsA("BasePart") and item or item:FindFirstChildWhichIsA("BasePart", true)
                    if part then
                        local highlight = part:FindFirstChild("ITEM_ESP_Highlight")
                        local color = getItemHighlightColor(item.Name)
                        
                        if not highlight then
                            highlight = Instance.new("Highlight")
                            highlight.Name = "ITEM_ESP_Highlight"
                            highlight.Adornee = part
                            highlight.FillColor = color
                            highlight.OutlineColor = color
                            highlight.FillTransparency = 0.6
                            highlight.OutlineTransparency = 0.1
                            highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
                            highlight.Parent = part
                        else
                            highlight.FillColor = color
                            highlight.OutlineColor = color
                        end
                        
                        local billboardGui = part:FindFirstChild("ITEM_ESP_Label")
                        
                        if not billboardGui then
                            billboardGui = Instance.new("BillboardGui")
                            billboardGui.Name = "ITEM_ESP_Label"
                            billboardGui.Adornee = part
                            billboardGui.Size = UDim2.new(0, 120, 0, 30)
                            billboardGui.StudsOffset = Vector3.new(0, 2.5, 0)
                            billboardGui.MaxDistance = math.huge
                            billboardGui.AlwaysOnTop = true
                            
                            local textLabel = Instance.new("TextLabel")
                            textLabel.Name = "ItemInfo"
                            textLabel.Size = UDim2.new(1, 0, 1, 0)
                            textLabel.BackgroundTransparency = 1
                            textLabel.TextColor3 = color
                            textLabel.TextSize = 12
                            textLabel.Font = Enum.Font.GothamBold
                            textLabel.TextStrokeTransparency = 0.3
                            textLabel.TextScaled = false
                            textLabel.Parent = billboardGui
                            
                            billboardGui.Parent = part
                        end
                        
                        local label = billboardGui:FindFirstChild("ItemInfo")
                        if label then
                            label.Text = item.Name
                            label.TextColor3 = color
                        end
                    end
                end
            end
        end
    end)
end

local function stopItemsESP()
    if itemsEspLoop then task.cancel(itemsEspLoop) end
    
    task.wait(0.1)
    
    for _, obj in ipairs(workspace:GetDescendants()) do
        if (obj.Name == "ITEM_ESP_Highlight" or obj.Name == "ITEM_ESP_Label") then
            pcall(function() obj:Destroy() end)
        end
    end
    
    print("✅ ESP Items Importantes eliminado completamente")
end

-- ================= ESP METEOR CORE =================

local function startMeteorESP()
    if meteorEspLoop then task.cancel(meteorEspLoop) end
    
    meteorEspLoop = task.spawn(function()
        while meteorEspActive do
            task.wait(0.2)
            
            local meteor = workspace:FindFirstChild("Meteor Core")
            if meteor and (meteor:IsA("BasePart") or meteor:IsA("Model")) then
                local adornee = meteor
                if meteor:IsA("Model") then
                    adornee = meteor:FindFirstChildWhichIsA("BasePart", true) or meteor
                end
                
                if adornee then
                    local highlight = adornee:FindFirstChild("METEOR_ESP_Highlight")
                    
                    if not highlight then
                        highlight = Instance.new("Highlight")
                        highlight.Name = "METEOR_ESP_Highlight"
                        highlight.Adornee = adornee
                        highlight.FillColor = Color3.fromRGB(255, 100, 100)
                        highlight.OutlineColor = Color3.fromRGB(255, 0, 0)
                        highlight.FillTransparency = 0.5
                        highlight.OutlineTransparency = 0.1
                        highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop
                        highlight.Parent = adornee
                    end
                    
                    local billboardGui = adornee:FindFirstChild("METEOR_ESP_Label")
                    
                    if not billboardGui then
                        billboardGui = Instance.new("BillboardGui")
                        billboardGui.Name = "METEOR_ESP_Label"
                        billboardGui.Adornee = adornee
                        billboardGui.Size = UDim2.new(0, 140, 0, 35)
                        billboardGui.StudsOffset = Vector3.new(0, 4, 0)
                        billboardGui.MaxDistance = math.huge
                        billboardGui.AlwaysOnTop = true
                        
                        local textLabel = Instance.new("TextLabel")
                        textLabel.Name = "MeteorInfo"
                        textLabel.Size = UDim2.new(1, 0, 1, 0)
                        textLabel.BackgroundTransparency = 1
                        textLabel.TextColor3 = Color3.fromRGB(255, 80, 80)
                        textLabel.TextSize = 13
                        textLabel.Font = Enum.Font.GothamBold
                        textLabel.TextStrokeTransparency = 0.2
                        textLabel.Text = "Meteor Core"
                        textLabel.TextScaled = false
                        textLabel.Parent = billboardGui
                        
                        billboardGui.Parent = adornee
                    end
                end
            end
        end
    end)
end

local function stopMeteorESP()
    if meteorEspLoop then task.cancel(meteorEspLoop) end
    
    task.wait(0.1)
    
    for _, obj in ipairs(workspace:GetDescendants()) do
        if (obj.Name == "METEOR_ESP_Highlight" or obj.Name == "METEOR_ESP_Label") then
            pcall(function() obj:Destroy() end)
        end
    end
    
    print("✅ ESP Meteor Core eliminado completamente")
end

-- ================= CAMERA NOCLIP (solo cámara visual, optimizado) =================

local function setDeployablesTransparency(makeTransparent)
    local deployables = workspace:FindFirstChild("Deployables")
    if not deployables then return end
    
    for _, part in ipairs(deployables:GetDescendants()) do
        if part:IsA("BasePart") then
            if makeTransparent then
                if part:GetAttribute("OriginalTransparency") == nil then
                    part:SetAttribute("OriginalTransparency", part.Transparency)
                end
                part.Transparency = 0.8 -- casi invisibles pero se ven un poco
            else
                local original = part:GetAttribute("OriginalTransparency")
                if original ~= nil then
                    part.Transparency = original
                    part:SetAttribute("OriginalTransparency", nil)
                end
            end
        end
    end
end

local function startCameraNoclip()
    cameraNoclipActive = true
    setDeployablesTransparency(true)
    print("✅ Camera Noclip ACTIVADO")
end

local function stopCameraNoclip()
    cameraNoclipActive = false
    setDeployablesTransparency(false)
    print("❌ Camera Noclip DESACTIVADO")
end

-- ============ AUTOPICKUP TAB ============

AutopickupTab:CreateToggle({
    Name = "Activar Autopickup",
    CurrentValue = false,
    Callback = function(Value)
        pickupActive = Value
        if pickupActive then
            startPickupLoop()
            print("✅ Autopickup ACTIVADO")
        else
            if pickupLoop then task.cancel(pickupLoop) end
            print("❌ Autopickup DESACTIVADO")
        end
    end,
})

AutopickupTab:CreateDivider()

for itemName, _ in pairs(itemFilters) do
    AutopickupTab:CreateToggle({
        Name = itemName,
        CurrentValue = true,
        Callback = function(Value)
            itemFilters[itemName] = Value
            print(itemName .. ": " .. (Value and "✅ ACTIVADO" or "❌ DESACTIVADO"))
        end,
    })
end

-- ============ MISC TAB ============

MiscTab:CreateToggle({
    Name = "Delete All Items",
    CurrentValue = false,
    Callback = function(Value)
        deleteItemsActive = Value
        if deleteItemsActive then
            startDeleteItemsLoop()
            print("✅ Delete All Items ACTIVADO")
        else
            if deleteItemsLoop then task.cancel(deleteItemsLoop) end
            print("❌ Delete All Items DESACTIVADO")
        end
    end,
})

MiscTab:CreateToggle({
    Name = "Player ESP",
    CurrentValue = false,
    Callback = function(Value)
        espActive = Value
        if espActive then
            startESP()
            print("✅ Player ESP ACTIVADO")
        else
            stopESP()
            print("❌ Player ESP DESACTIVADO")
        end
    end,
})

MiscTab:CreateToggle({
    Name = "ESP DIOSES",
    CurrentValue = false,
    Callback = function(Value)
        godEspActive = Value
        if godEspActive then
            startGodESP()
            print("✅ ESP DIOSES ACTIVADO")
        else
            stopGodESP()
            print("❌ ESP DIOSES DESACTIVADO")
        end
    end,
})

MiscTab:CreateToggle({
    Name = "ESP Items Importantes",
    CurrentValue = false,
    Callback = function(Value)
        itemsEspActive = Value
        if itemsEspActive then
            startItemsESP()
            print("✅ ESP Items Importantes ACTIVADO")
        else
            stopItemsESP()
            print("❌ ESP Items Importantes DESACTIVADO")
        end
    end,
})

MiscTab:CreateToggle({
    Name = "ESP Meteor Core",
    CurrentValue = false,
    Callback = function(Value)
        meteorEspActive = Value
        if meteorEspActive then
            startMeteorESP()
            print("✅ ESP Meteor Core ACTIVADO")
        else
            stopMeteorESP()
            print("❌ ESP Meteor Core DESACTIVADO")
        end
    end,
})

MiscTab:CreateToggle({
    Name = "Camera Noclip",
    CurrentValue = false,
    Callback = function(Value)
        if Value then
            startCameraNoclip()
        else
            stopCameraNoclip()
        end
    end,
})

print("✅ Script cargado correctamente")
